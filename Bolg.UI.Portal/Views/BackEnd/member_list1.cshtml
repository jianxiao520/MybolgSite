<!DOCTYPE html>
<html class="x-admin-sm">

<head>
    <meta charset="UTF-8">
    <title>欢迎页面-X-admin2.2</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
    <link href="~/Content/css/font.css" rel="stylesheet" />
    <script src="~/Scripts/layui/layui.js"></script>
    <link href="~/Content/css/xadmin.css" rel="stylesheet" />
    <script src="~/Scripts/xadmin.js"></script>
</head>
<body>
    <div class="x-nav">
        <span class="layui-breadcrumb">
            <a href="">首页</a>
            <a>
                <cite>用户管理</cite>
            </a>
        </span>
        <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" onclick="location.reload()"
           title="刷新">
            <i class="layui-icon layui-icon-refresh" style="line-height:30px"></i>
        </a>
    </div>
    <div class="layui-fluid">
        <div class="layui-row layui-col-space15">
            <div class="layui-col-md12">
                <div class="layui-card">
                    <div class="layui-card-body ">
                    </div>
                    <div class="layui-card-body">
                        <table class="layui-table" lay-filter="test" id="test">
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script type="text/html" id="switchTpl">
    <!-- 这里的checked的状态只是演示 -->
    <input type="checkbox" name="sex" value="{{d.Us_Id}}" lay-skin="switch" lay-text="女|男" lay-filter="sexDemo" {{ d.Us_Sex == 1 ? 'checked': ''}}>
</script>
<script type="text/html" id="checkboxTpl">
    <!-- 这里的 checked 的状态只是演示 -->
    <input type="checkbox" name="lock" value="{{d.Us_Id}}" title="删除" lay-filter="lockDemo" {{ d.Is_Del == -1 ? 'checked' : '' }}>
</script>
<script>
    var table,form;
    layui.use('table', function () {
        table = layui.table;
        form = layui.form;
        //监听单元格编辑
        table.on('edit(test)',
            function (obj) {
                var value = obj.value, data = obj.data, field = obj.field; //得到字段
                $.get("UserInfo?Method=AlterInfo&Us_Id=" + data.Us_Id + "&key=" + field + "&value=" + value, function (Result) {
                    layer.msg("修改信息:" + Result.Msg);
                })
            });
        //监听性别操作
        form.on('switch(sexDemo)', function (obj) {
            $.get("UserInfo?Method=AlterInfo&Us_Id=" + this.value + "&key=Us_Sex&value=" + (obj.elem.checked == true ? "1" : "0"), function (Result) {
                layer.msg("修改信息:" + Result.Msg);
            });
        });
        //监听锁定操作
        form.on('checkbox(lockDemo)', function (obj) {
            $.get("UserInfo?Method=AlterInfo&Us_Id=" + this.value + "&key=Is_Del&value=" + (obj.elem.checked == true ? "-1" : "0"), function (Result) {
                layer.msg("修改信息:" + Result.Msg);
            });
        });

        //初始化
        table.render({
            elem: '#test'
            , url: 'UserInfo?Method=GetUserInfo'
            , cols: [[
                { field: 'Us_Id', title: 'UserID', width: 100, sort: true, fixed: 'left', unresize: true }
                , { field: 'Us_UserName', title: '用户名', width: 120, sort: true, edit: 'text' }
                , { field: 'Us_NickName', title: '昵称', width: 120, edit: 'text' }
                , { field: 'Us_Phone', title: '手机号', width: 150, edit: 'text', sort: true }
                , { field: 'Us_Eamil', title: '邮箱', width: 200, sort: true, edit: 'text' }
                , { field: 'Us_Sex', title: '性别', width: 80, templet: '#switchTpl' }
                , {
                    field: 'Us_Birthday', title: '出生日期', width: 150, edit: 'text', sort: true, templet: function (res) {
                        return ProcessDate(res.Us_Birthday);
                    }
                }
                , { field: 'Us_Ip', title: 'IP', width: 200, sort: true }
                , {
                    field: 'Us_RegisterTime', title: '注册时间', sort: true, width: 200, templet: function (res) {
                        return ProcessDate(res.Us_RegisterTime);
                    }
                }
                , { field: 'Is_Del', title: '是否已删除', width: 100, templet: '#checkboxTpl'  }
            ]]
            , page: true
        });
    });
    function ProcessDate(DateData) {
        if (DateData == null) {
            return ""
        }
        var timestamp = DateData;
        var date = new Date(parseInt(timestamp.replace("/Date(", "").replace(")/", ""), 10));
        Y = date.getFullYear() + '-';
        M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '-';
        D = (date.getDate() < 10 ? '0' + (date.getDate()) : date.getDate()) + ' ';
        h = (date.getHours() < 10 ? '0' + (date.getHours()) : date.getHours()) + ':';
        m = (date.getMinutes() < 10 ? '0' + (date.getMinutes()) : date.getMinutes()) + ':';
        s = (date.getSeconds() < 10 ? '0' + (date.getSeconds()) : date.getSeconds());
        var NewDtime = Y + M + D + h + m + s;
        return NewDtime;
    }
</script>

</html>
